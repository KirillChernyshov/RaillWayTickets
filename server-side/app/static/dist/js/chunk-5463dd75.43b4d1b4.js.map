{"version":3,"sources":["webpack:///./src/views/Timetable.vue?fc0a","webpack:///./src/components/BookTicket.vue?ca07","webpack:///src/components/BookTicket.vue","webpack:///./src/components/BookTicket.vue?1728","webpack:///./src/components/BookTicket.vue","webpack:///./src/components/IssueTicket.vue?01dc","webpack:///src/components/IssueTicket.vue","webpack:///./src/components/IssueTicket.vue?488d","webpack:///./src/components/IssueTicket.vue","webpack:///src/views/Timetable.vue","webpack:///./src/views/Timetable.vue?7fb0","webpack:///./src/views/Timetable.vue","webpack:///./src/views/Timetable.vue?11d2","webpack:///./src/components/IssueTicket.vue?5ae6","webpack:///./src/components/BookTicket.vue?db88"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","cities","model","value","callback","$$v","dep_station_name","expression","arr_station_name","date","time","on","$event","search","_v","load","routes","fields","scopedSlots","_u","key","fn","row","role","showBookTicket","item","_e","showIssueTicket","proxy","_b","bookTicket","staticRenderFns","hideBookTicket","_l","_s","header","seat","cost","seats","component","hideIssueTicket","issueTicket"],"mappings":"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","file":"dist/js/chunk-5463dd75.43b4d1b4.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"timetable\"},[_c('b-form',{staticClass:\"search\",attrs:{\"inline\":\"\"}},[_c('b-form-group',{attrs:{\"label\":\"Станция отбытия\"}},[_c('b-form-select',{staticClass:\"mb-2 mr-sm-2 mb-sm-0\",attrs:{\"options\":_vm.cities},model:{value:(_vm.dep_station_name),callback:function ($$v) {_vm.dep_station_name=$$v},expression:\"dep_station_name\"}})],1),_c('b-form-group',{attrs:{\"label\":\"Станция прибытия\"}},[_c('b-form-select',{staticClass:\"mb-2 mr-sm-2 mb-sm-0\",attrs:{\"options\":_vm.cities},model:{value:(_vm.arr_station_name),callback:function ($$v) {_vm.arr_station_name=$$v},expression:\"arr_station_name\"}})],1),_c('b-form-group',{attrs:{\"label\":\"Дата прибытия\"}},[_c('b-form-datepicker',{staticClass:\"mb-2 mr-sm-2 mb-sm-0\",model:{value:(_vm.date),callback:function ($$v) {_vm.date=$$v},expression:\"date\"}})],1),_c('b-form-group',{attrs:{\"label\":\"Время прибытия\"}},[_c('b-form-timepicker',{staticClass:\"mb-2 mr-sm-2 mb-sm-0\",model:{value:(_vm.time),callback:function ($$v) {_vm.time=$$v},expression:\"time\"}})],1),_c('b-button',{staticClass:\"btn\",on:{\"click\":function($event){return _vm.search()}}},[_vm._v(\"Поиск\")])],1),_c('b-table',{staticClass:\"align-left routes\",attrs:{\"busy\":_vm.load,\"sticky-header\":\"\",\"striped\":\"\",\"hover\":\"\",\"items\":_vm.routes,\"fields\":_vm.fields},scopedSlots:_vm._u([{key:\"cell(actions)\",fn:function(row){return [(_vm.role == 'client')?_c('b-button',{staticClass:\"mr-2\",attrs:{\"size\":\"sm\",\"variant\":\"info\"},on:{\"click\":function($event){return _vm.showBookTicket(row.item)}}},[_vm._v(\" Бронировать билет \")]):_vm._e(),(_vm.role == 'manager')?_c('b-button',{staticClass:\"mr-2\",attrs:{\"size\":\"sm\",\"variant\":\"info\"},on:{\"click\":function($event){return _vm.showIssueTicket(row.item)}}},[_vm._v(\" Оформить билет \")]):_vm._e()]}},{key:\"table-busy\",fn:function(){return [_c('div',{staticClass:\"text-center text-info my-2\"},[_c('b-spinner',{staticClass:\"align-middle\"}),_c('strong',[_vm._v(\" Загрузка...\")])],1)]},proxy:true}])}),_c('BookTicket',_vm._b({on:{\"search\":_vm.search}},'BookTicket',_vm.bookTicket,false)),_c('IssueTicket',_vm._b({on:{\"search\":_vm.search}},'IssueTicket',_vm.bookTicket,false))],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('b-modal',{attrs:{\"id\":\"book_ticket\",\"title\":\"Бронирование билета\",\"ok-only\":\"\"},on:{\"hidden\":_vm.hideBookTicket,\"ok\":_vm.bookTicket}},[_vm._l((_vm.dataList),function(item,key){return _c('div',{key:key},[_c('span',[_vm._v(_vm._s(item.header)+\":\")]),_vm._v(\" \"+_vm._s(item.value)+\" \")])}),_c('div',[_c('span',[_vm._v(\"Цена:\")]),_vm._v(\" \"+_vm._s(_vm.seat.cost)+\" \")]),_c('b-row',[_c('b-col',{attrs:{\"sm\":\"2\"}},[_c('span',[_vm._v(\"Место:\")])]),_c('b-col',{attrs:{\"sm\":\"8\"}},[_c('b-select',{attrs:{\"size\":\"sm\",\"options\":_vm.seats},model:{value:(_vm.seat),callback:function ($$v) {_vm.seat=$$v},expression:\"seat\"}})],1)],1),_c('b-form')],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"html\">\r\n    <b-modal id=\"book_ticket\" title=\"Бронирование билета\"\r\n        @hidden=\"hideBookTicket\"\r\n        ok-only\r\n        @ok=\"bookTicket\"\r\n    >\r\n        <div v-for=\"(item, key) in dataList\" :key=\"key\">\r\n            <span>{{ item.header }}:</span> {{ item.value }}\r\n        </div>\r\n        <div>\r\n            <span>Цена:</span> {{ seat.cost }}\r\n        </div>\r\n        <b-row>\r\n            <b-col sm=\"2\">\r\n                <span>Место:</span>\r\n            </b-col>\r\n            <b-col sm=\"8\">\r\n                <b-select size=\"sm\" v-model=\"seat\" :options=\"seats\" ></b-select>\r\n            </b-col>\r\n        </b-row>\r\n        <b-form>\r\n\r\n        </b-form>\r\n    </b-modal>\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapMutations } from 'vuex'\r\n\r\nexport default {\r\n    name: \"BookTicket\",\r\n    data: () => ({\r\n        seat: {},\r\n    }),\r\n    computed: {\r\n        ...mapState({\r\n            firstname: state => state.user.local.firstname,\r\n            lastname: state => state.user.local.lastname,\r\n            show: state => state.bookTicket.show,\r\n            bookData: state => state.bookTicket.data,\r\n            wagon_seats_info: state => state.bookTicket.wagon_seats_info,\r\n        }),\r\n        dataList() {\r\n            return {\r\n                // name: {\r\n                //     header: 'Имя',\r\n                //     value: `${this.firstname} ${this.lastname}`,\r\n                // },\r\n                route: {\r\n                    header: 'Маршрут',\r\n                    value: this.bookData.route_name,\r\n                },\r\n                trainNum: {\r\n                    header: 'Номер поезда',\r\n                    value: this.bookData.schedule_id,\r\n                },\r\n                dep: {\r\n                    header: 'Станция и время отбытия',\r\n                    value: `${this.bookData.dep_station_name} / ${this.bookData.departure_time}`,\r\n                },\r\n                arr: {\r\n                    header: 'Станция и время прибытия',\r\n                    value: `${this.bookData.arr_station_name} / ${this.bookData.arrival_time}`,\r\n                },\r\n                // price: {\r\n                //     header: 'Стоимость',\r\n                //     value: `${this.bookData.price}`,\r\n                // },\r\n            }\r\n        },\r\n        seats() {\r\n            if (this.wagon_seats_info)\r\n                if (!this.wagon_seats_info.length) return [];\r\n\r\n            let seats = [];\r\n\r\n            this.wagon_seats_info.forEach((wagon) => {\r\n                wagon.empty_places.forEach((seat) => {\r\n                    seats.push({\r\n                        value: {\r\n                            cost: wagon.cost,\r\n                            wagon_id: wagon.wagon_num,\r\n                            place: seat,\r\n                        },\r\n                        text: `Вагон: ${wagon.wagon_num} | Место: ${seat} | Тип: ${wagon.type_name}`,\r\n                    });\r\n                });\r\n\r\n            });\r\n\r\n            return seats;\r\n        }\r\n    },\r\n    methods: {\r\n        ...mapMutations('bookTicket', [\r\n            'hideBookTicket',\r\n        ]),\r\n        bookTicket() {\r\n            this.$store.dispatch('bookTicket/bookTicket', {\r\n                cost: this.seat.cost,\r\n                place: this.seat.place,\r\n                wagon_id: this.seat.wagon_id,\r\n                schedule_id: this.bookData.schedule_id,\r\n                arrival_stop_id: this.bookData.arr_stop_id,\r\n                departure_stop_id: this.bookData.dep_stop_id,\r\n            });\r\n\r\n            this.$emit('search');\r\n        }\r\n    },\r\n    watch: {\r\n        show(val) {\r\n            if (val) {\r\n                this.$bvModal.show('book_ticket');\r\n                // console.log(this.bookData);\r\n                this.$store.dispatch('bookTicket/getRouteInfo', {\r\n                    arr_stop_id: this.bookData.arr_stop_id,\r\n                    dep_stop_id: this.bookData.dep_stop_id,\r\n                    schedule_id: this.bookData.schedule_id,\r\n                });\r\n            }\r\n            else\r\n                this.$bvModal.hide('book_ticket');\r\n        },\r\n        seats(val) {\r\n            if (val.length)\r\n                this.seat = val[0].value;\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"css\" scoped>\r\n    span {\r\n        font-weight: bold;\r\n    }\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BookTicket.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BookTicket.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./BookTicket.vue?vue&type=template&id=682a1db2&scoped=true&lang=html&\"\nimport script from \"./BookTicket.vue?vue&type=script&lang=js&\"\nexport * from \"./BookTicket.vue?vue&type=script&lang=js&\"\nimport style0 from \"./BookTicket.vue?vue&type=style&index=0&id=682a1db2&lang=css&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"682a1db2\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('b-modal',{attrs:{\"id\":\"issue_ticket\",\"title\":\"Оформление билета\",\"ok-only\":\"\"},on:{\"hidden\":_vm.hideIssueTicket,\"ok\":_vm.issueTicket}},[_vm._l((_vm.dataList),function(item,key){return _c('div',{key:key},[_c('span',[_vm._v(_vm._s(item.header)+\":\")]),_vm._v(\" \"+_vm._s(item.value)+\" \")])}),_c('div',[_c('span',[_vm._v(\"Цена:\")]),_vm._v(\" \"+_vm._s(_vm.seat.cost)+\" \")]),_c('b-row',[_c('b-col',{attrs:{\"sm\":\"2\"}},[_c('span',[_vm._v(\"Место:\")])]),_c('b-col',{attrs:{\"sm\":\"8\"}},[_c('b-select',{attrs:{\"size\":\"sm\",\"options\":_vm.seats},model:{value:(_vm.seat),callback:function ($$v) {_vm.seat=$$v},expression:\"seat\"}})],1)],1)],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"html\">\r\n    <b-modal id=\"issue_ticket\" title=\"Оформление билета\"\r\n        @hidden=\"hideIssueTicket\"\r\n        ok-only\r\n        @ok=\"issueTicket\"\r\n    >\r\n        <!-- <b-row>\r\n            <b-col sm=\"2\">\r\n                <span>Имя:</span>\r\n            </b-col>\r\n            <b-col sm=\"8\">\r\n                <b-input size=\"sm\" v-model=\"firstname\" ></b-input>\r\n            </b-col>\r\n        </b-row>\r\n        <b-row>\r\n            <b-col sm=\"2\">\r\n                <span>Фамилия:</span>\r\n            </b-col>\r\n            <b-col sm=\"8\">\r\n                <b-input size=\"sm\" v-model=\"lastname\" ></b-input>\r\n            </b-col>\r\n        </b-row> -->\r\n        <div v-for=\"(item, key) in dataList\" :key=\"key\">\r\n            <span>{{ item.header }}:</span> {{ item.value }}\r\n        </div>\r\n        <div>\r\n            <span>Цена:</span> {{ seat.cost }}\r\n        </div>\r\n        <b-row>\r\n            <b-col sm=\"2\">\r\n                <span>Место:</span>\r\n            </b-col>\r\n            <b-col sm=\"8\">\r\n                <b-select size=\"sm\" v-model=\"seat\" :options=\"seats\" ></b-select>\r\n            </b-col>\r\n        </b-row>\r\n    </b-modal>\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapMutations } from 'vuex'\r\n\r\nexport default {\r\n    name: \"BookTicket\",\r\n    data: () => ({\r\n        seat: {},\r\n        firstname: '',\r\n        lastname: '',\r\n    }),\r\n    computed: {\r\n        ...mapState({\r\n            show: state => state.bookTicket.showIssue,\r\n            bookData: state => state.bookTicket.data,\r\n            wagon_seats_info: state => state.bookTicket.wagon_seats_info,\r\n        }),\r\n        dataList() {\r\n            return {\r\n                // name: {\r\n                //     header: 'Имя',\r\n                //     value: `${this.firstname} ${this.lastname}`,\r\n                // },\r\n                route: {\r\n                    header: 'Маршрут',\r\n                    value: this.bookData.route_name,\r\n                },\r\n                trainNum: {\r\n                    header: 'Номер поезда',\r\n                    value: this.bookData.schedule_id,\r\n                },\r\n                dep: {\r\n                    header: 'Станция и время отбытия',\r\n                    value: `${this.bookData.dep_station_name} / ${this.bookData.departure_time}`,\r\n                },\r\n                arr: {\r\n                    header: 'Станция и время прибытия',\r\n                    value: `${this.bookData.arr_station_name} / ${this.bookData.arrival_time}`,\r\n                },\r\n                // price: {\r\n                //     header: 'Стоимость',\r\n                //     value: `${this.bookData.price}`,\r\n                // },\r\n            }\r\n        },\r\n        seats() {\r\n            if (this.wagon_seats_info)\r\n                if (!this.wagon_seats_info.length) return [];\r\n\r\n            let seats = [];\r\n\r\n            this.wagon_seats_info.forEach((wagon) => {\r\n                wagon.empty_places.forEach((seat) => {\r\n                    seats.push({\r\n                        value: {\r\n                            cost: wagon.cost,\r\n                            wagon_id: wagon.wagon_num,\r\n                            place: seat,\r\n                        },\r\n                        text: `Вагон: ${wagon.wagon_num} | Место: ${seat} | Тип: ${wagon.type_name}`,\r\n                    });\r\n                });\r\n\r\n            });\r\n\r\n            return seats;\r\n        }\r\n    },\r\n    methods: {\r\n        ...mapMutations('bookTicket', [\r\n            'hideIssueTicket',\r\n        ]),\r\n        issueTicket() {\r\n            this.$store.dispatch('bookTicket/issueTicket', {\r\n                cost: this.seat.cost,\r\n                place: this.seat.place,\r\n                wagon_id: this.seat.wagon_id,\r\n                schedule_id: this.bookData.schedule_id,\r\n                arrival_stop_id: this.bookData.arr_stop_id,\r\n                departure_stop_id: this.bookData.dep_stop_id,\r\n            });\r\n\r\n            this.$emit('search');\r\n        }\r\n    },\r\n    watch: {\r\n        show(val) {\r\n            if (val) {\r\n                this.$bvModal.show('issue_ticket');\r\n                // console.log(this.bookData);\r\n                this.$store.dispatch('bookTicket/getRouteInfo', {\r\n                    arr_stop_id: this.bookData.arr_stop_id,\r\n                    dep_stop_id: this.bookData.dep_stop_id,\r\n                    schedule_id: this.bookData.schedule_id,\r\n                });\r\n            }\r\n            else\r\n                this.$bvModal.hide('issue_ticket');\r\n        },\r\n        seats(val) {\r\n            if (val.length)\r\n                this.seat = val[0].value;\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"css\" scoped>\r\n    span {\r\n        font-weight: bold;\r\n    }\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IssueTicket.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IssueTicket.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./IssueTicket.vue?vue&type=template&id=f9584bb4&scoped=true&lang=html&\"\nimport script from \"./IssueTicket.vue?vue&type=script&lang=js&\"\nexport * from \"./IssueTicket.vue?vue&type=script&lang=js&\"\nimport style0 from \"./IssueTicket.vue?vue&type=style&index=0&id=f9584bb4&lang=css&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f9584bb4\",\n  null\n  \n)\n\nexport default component.exports","<template lang=\"html\">\r\n    <div class=\"timetable\">\r\n        <b-form class=\"search\" inline>\r\n            <b-form-group\r\n                label=\"Станция отбытия\"\r\n            >\r\n                <b-form-select\r\n                    v-model=\"dep_station_name\"\r\n                    :options=\"cities\"\r\n                    class=\"mb-2 mr-sm-2 mb-sm-0\"\r\n                ></b-form-select>\r\n            </b-form-group>\r\n\r\n            <b-form-group\r\n                label=\"Станция прибытия\"\r\n            >\r\n                <b-form-select\r\n                    v-model=\"arr_station_name\"\r\n                    :options=\"cities\"\r\n                    class=\"mb-2 mr-sm-2 mb-sm-0\"\r\n                ></b-form-select>\r\n            </b-form-group>\r\n            <b-form-group\r\n                label=\"Дата прибытия\"\r\n            >\r\n                <b-form-datepicker\r\n                    v-model=\"date\"\r\n                    class=\"mb-2 mr-sm-2 mb-sm-0\"\r\n                ></b-form-datepicker>\r\n            </b-form-group>\r\n            <b-form-group\r\n                label=\"Время прибытия\"\r\n            >\r\n                <b-form-timepicker\r\n                    v-model=\"time\"\r\n                    class=\"mb-2 mr-sm-2 mb-sm-0\"\r\n                ></b-form-timepicker>\r\n            </b-form-group>\r\n            <b-button class=\"btn\" @click=\"search()\">Поиск</b-button>\r\n        </b-form>\r\n\r\n        <b-table :busy=\"load\" sticky-header class=\"align-left routes\" striped hover :items=\"routes\" :fields=\"fields\">\r\n            <template v-show=\"false\" v-slot:cell(actions)=\"row\">\r\n                <b-button\r\n                    v-if=\"role == 'client'\"\r\n                    size=\"sm\"\r\n                    variant=\"info\"\r\n                    @click=\"showBookTicket(row.item)\"\r\n                    class=\"mr-2\"\r\n                >\r\n                  Бронировать билет\r\n                </b-button>\r\n                <b-button\r\n                    v-if=\"role == 'manager'\"\r\n                    size=\"sm\"\r\n                    variant=\"info\"\r\n                    @click=\"showIssueTicket(row.item)\"\r\n                    class=\"mr-2\"\r\n                >\r\n                 Оформить билет\r\n                </b-button>\r\n            </template>\r\n            <template v-slot:table-busy>\r\n                <div class=\"text-center text-info my-2\">\r\n                    <b-spinner class=\"align-middle\"></b-spinner>\r\n                    <strong> Загрузка...</strong>\r\n                </div>\r\n            </template>\r\n        </b-table>\r\n\r\n        <BookTicket v-bind=\"bookTicket\" @search=\"search\"/>\r\n        <IssueTicket v-bind=\"bookTicket\" @search=\"search\"/>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapMutations } from 'vuex'\r\nimport moment from 'moment'\r\nimport BookTicket from '../components/BookTicket.vue'\r\nimport IssueTicket from '../components/IssueTicket.vue'\r\n\r\nexport default {\r\n    name: \"timetable\",\r\n    data: () => ({\r\n        arr_station_name: null,\r\n        dep_station_name: null,\r\n        date: moment().add(1, 'day').format('YYYY-MM-DD'),\r\n        time: moment().format('HH:mm:ss'),\r\n        bookTicket: {\r\n        },\r\n    }),\r\n    computed: {\r\n        ...mapState({\r\n            cities: state => state.timetable.cities,\r\n            load: state => state.timetable.load,\r\n            routes: state => state.timetable.routes,\r\n            role: state => state.user.local.role,\r\n        }),\r\n        rDate() {\r\n            return moment(this.date).add(this.time).format();\r\n        },\r\n        fields() {\r\n            return [\r\n                {\r\n                    key: \"dep_station_name\",\r\n                    label: \"Станция отбытия\",\r\n                },\r\n                {\r\n                    key: \"departure_time\",\r\n                    label: \"Время отбытия\"\r\n                },\r\n                {\r\n                    key: \"arr_station_name\",\r\n                    label: \"Станция прибытия\"\r\n                },\r\n                {\r\n                    key: \"arrival_time\",\r\n                    label: \"Время прибытия\"\r\n                },\r\n                {\r\n                    key: \"route_name\",\r\n                    label: \"Маршрут\"\r\n                },\r\n                {\r\n                    key: \"places\",\r\n                    label: \"Места\"\r\n                },\r\n                (this.role) ? {\r\n                    key: \"actions\",\r\n                    label: \"Действия\"\r\n                } : {}\r\n            ];\r\n        }\r\n    },\r\n    methods: {\r\n        search() {\r\n            this.$store.dispatch('timetable/searchRoutes', {\r\n                arrival_date: this.rDate,\r\n                arrival_province_name: this.arr_station_name,\r\n                departure_province_name: this.dep_station_name,\r\n            });\r\n        },\r\n        ...mapMutations('bookTicket', [\r\n            'showBookTicket',\r\n            'showIssueTicket'\r\n        ])\r\n        // showBookTicket(data) {\r\n        //     this.$store.commit('bookTicket/showBookTicket', data);\r\n        // }\r\n    },\r\n    watch: {\r\n        cities(val) {\r\n            if (val.length < 2) return;\r\n\r\n            this.arr_station_name = val[0];\r\n            this.dep_station_name = val[1];\r\n        },\r\n    },\r\n    components: {\r\n        BookTicket,\r\n        IssueTicket,\r\n    },\r\n    created() {\r\n        this.$store.dispatch('timetable/getCitiesList');\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"css\" scoped>\r\n    .timetable {\r\n        text-align: left;\r\n\r\n    }\r\n\r\n    .timetable .search {\r\n        margin: 10px 30px;\r\n    }\r\n\r\n    .timetable .search .btn {\r\n        margin: auto auto 0 0;\r\n    }\r\n\r\n    .timetable .routes {\r\n        max-height: 70vh;\r\n    }\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Timetable.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Timetable.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Timetable.vue?vue&type=template&id=9855d7e8&scoped=true&lang=html&\"\nimport script from \"./Timetable.vue?vue&type=script&lang=js&\"\nexport * from \"./Timetable.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Timetable.vue?vue&type=style&index=0&id=9855d7e8&lang=css&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"9855d7e8\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Timetable.vue?vue&type=style&index=0&id=9855d7e8&lang=css&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Timetable.vue?vue&type=style&index=0&id=9855d7e8&lang=css&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IssueTicket.vue?vue&type=style&index=0&id=f9584bb4&lang=css&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IssueTicket.vue?vue&type=style&index=0&id=f9584bb4&lang=css&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BookTicket.vue?vue&type=style&index=0&id=682a1db2&lang=css&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BookTicket.vue?vue&type=style&index=0&id=682a1db2&lang=css&scoped=true&\""],"sourceRoot":""}